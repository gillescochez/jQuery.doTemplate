/*! github.com/gillescochez/$.doTemplate */
(function(){$.doTemplate=function(){var a={},b=function(b){if(!b.name)throw"$.doTemplate: A name must be provided";return a[b.name]=function(a){return function(){return this.name=a.name,this.source=a.source,a.data&&(this.data=a.data,this.compile(a.data)),a.target&&this.compiled&&this.render(a.target),this}}(b),a[b.name].prototype=function(a){return{_compiler:$.doTemplate.template(a.source),compile:function(b){var c=document.createDocumentFragment(),d=this,e,f,g=function(b,g){e=d._compiler(g),f=$(e),f.data("doTemplate",{config:a,dataObject:g}).each(function(){c.appendChild(this)})};return b=b||this.data||!1,b?(b.constructor==Object&&(b=[b]),$.each(b,g),this.compiled=c,this.target&&this.render(this.target),this):this},render:function(a){return $(a).replaceWith(this.compiled),this}}}(b),$.each(["Data","Source","Target"],function(c,d){(function(c,d){a[b.name].prototype["set"+c]=function(a){return this[d]=a,this},a[b.name].prototype["get"+c]=function(){return this[d]}})(d,d.toLowerCase())}),new a[b.name]};return function(){var a=arguments;if(a.length===0)throw"$.doTemplate: required argument missing";if(a.length===1){if(a[0].constructor==String)return b({name:a[0]});if(a[0].constructor==Object)return b(a[0]);throw"$.doTemplate: invalid argument"}return a.length===2&&a[0].constructor==String&&a[1].constructor==String?b({name:a[0],source:a[1]}):a.length===3&&a[0].constructor==String&&a[1].constructor==String?b({name:a[0],source:a[1],data:a[2]}):a.length===4&&a[0].constructor==String&&a[1].constructor==String?b({name:a[0],source:a[1],data:a[2],target:a[3]}):{}}}(),$.doTemplate.get=function(a){var b;a instanceof jQuery&&(a=a[0]);while(a&&a.nodeType===1&&!(b=jQuery.data(a,"doTemplate"))&&(a=a.parentNode));return b||null},$.doTemplate.templateEngine=function(){var resolveDefs=function(c,block,def){return(typeof block=="string"?block:block.toString()).replace(c.define,function(match,code,assign,value){return code.indexOf("def.")===0&&(code=code.substring(4)),code in def||(assign===":"?def[code]=value:eval("def[code]="+value)),""}).replace(c.use,function(match,code){var v=eval(code);return v?resolveDefs(c,v,def):v})};return{create:function(a,b,c){b=$.extend($.doTemplate.templateEngine.settings,b,!0);var d=b.append?"'+(":"';out+=(",e=b.append?")+'":");out+='",f=b.use||b.define?resolveDefs(b,a,c||{}):a;f=("var out='"+(b.strip?f.replace(/\s*<!\[CDATA\[\s*|\s*\]\]>\s*|[\r\n\t]|(\/\*[\s\S]*?\*\/)/g,""):f).replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(b.interpolate,function(a,b){return d+b.replace(/\\'/g,"'").replace(/\\\\/g,"\\").replace(/[\r\t\n]/g," ")+e}).replace(b.encode,function(a,b){return d+b.replace(/\\'/g,"'").replace(/\\\\/g,"\\").replace(/[\r\t\n]/g," ")+").toString().replace(/&(?!\\w+;)/g, '&#38;').split('<').join('&#60;').split('>').join('&#62;').split('"+'"'+"').join('&#34;').split("+'"'+"'"+'"'+").join('&#39;').split('/').join('&#47;'"+e}).replace(b.evaluate,function(a,b){return"';"+b.replace(/\\'/g,"'").replace(/\\\\/g,"\\").replace(/[\r\t\n]/g," ")+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").split("out+='';").join("").split("var out='';out+=").join("var out=");try{return new Function(b.varname,f)}catch(g){throw g}}}}(),$.doTemplate.templateEngine.settings={evaluate:/\{\{([\s\S]+?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,varname:"it",strip:!0,append:!0},$.doTemplate.template=$.doTemplate.templateEngine.create,$.fn.doTemplate=function(a,b,c){return $.doTemplate({name:a,source:$(this).html(),target:c,data:b})},window.mucilage=mucilage})()